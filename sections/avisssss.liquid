{% comment %}
  testimonial-images-carousel.liquid
  Un snippet pour faire défiler des images d'avis clients existantes
  
  Utilisation:
  1. Créez ce fichier dans snippets/testimonial-images-carousel.liquid
  2. Incluez-le dans votre template avec {% render 'testimonial-images-carousel' %}
  3. Ajoutez vos images dans le répertoire Assets ou dans une collection
{% endcomment %}

<div class="testimonial-images-carousel-container">
  <div class="testimonial-images-carousel" id="testimonial-images-carousel">
    {% for block in section.blocks %}
      {% if block.type == 'testimonial_image' %}
        <div class="testimonial-image-slide" {{ block.shopify_attributes }}>
          {{ block.settings.testimonial_image | image_url: width: 800 | image_tag: 
             loading: 'lazy',
             class: 'testimonial-image',
             alt: block.settings.testimonial_alt }}
        </div>
      {% endif %}
    {% endfor %}
  </div>
  
  <div class="testimonial-images-navigation">
    <button class="nav-button prev-button" aria-label="Avis précédent">&#10094;</button>
    <div class="testimonial-images-indicators">
      {% for block in section.blocks %}
        {% if block.type == 'testimonial_image' %}
          <span class="indicator{% if forloop.first %} active{% endif %}" data-index="{{ forloop.index0 }}"></span>
        {% endif %}
      {% endfor %}
    </div>
    <button class="nav-button next-button" aria-label="Avis suivant">&#10095;</button>
  </div>
</div>

<style>
.testimonial-images-carousel-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
  position: relative;
}

.testimonial-images-carousel {
  display: flex;
  overflow: hidden;
  scroll-behavior: smooth;
  background-color: #f8f9fa;
  border-radius: 10px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.testimonial-image-slide {
  min-width: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 20px;
  box-sizing: border-box;
}

.testimonial-image {
  max-width: 100%;
  height: auto;
  border-radius: 8px;
}

.testimonial-images-navigation {
  display: flex;
  justify-content: center;
  align-items: center;
  margin-top: 20px;
}

.nav-button {
  background: none;
  border: none;
  font-size: 24px;
  cursor: pointer;
  color: #333;
  margin: 0 15px;
  padding: 5px 10px;
}

.nav-button:hover {
  color: #0066cc;
}

.testimonial-images-indicators {
  display: flex;
  gap: 8px;
}

.indicator {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background-color: #ccc;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.indicator.active {
  background-color: #0066cc;
}

@media (max-width: 768px) {
  .testimonial-image-slide {
    padding: 10px;
  }
}
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const carousel = document.getElementById('testimonial-images-carousel');
    const slides = carousel.querySelectorAll('.testimonial-image-slide');
    const indicators = document.querySelectorAll('.indicator');
    const prevButton = document.querySelector('.prev-button');
    const nextButton = document.querySelector('.next-button');
    let currentIndex = 0;
    const totalSlides = slides.length;
    
    function goToSlide(index) {
      if (index < 0) {
        index = totalSlides - 1;
      } else if (index >= totalSlides) {
        index = 0;
      }
      
      carousel.scrollTo({
        left: slides[index].offsetLeft,
        behavior: 'smooth'
      });
      
      // Update active indicator
      indicators.forEach((indicator, i) => {
        indicator.classList.toggle('active', i === index);
      });
      
      currentIndex = index;
    }
    
    // Navigation buttons
    prevButton.addEventListener('click', () => {
      goToSlide(currentIndex - 1);
    });
    
    nextButton.addEventListener('click', () => {
      goToSlide(currentIndex + 1);
    });
    
    // Indicator dots
    indicators.forEach((indicator, index) => {
      indicator.addEventListener('click', () => {
        goToSlide(index);
      });
    });

    // Optional: Touch swipe support for mobile
    let touchStartX = 0;
    let touchEndX = 0;
    
    carousel.addEventListener('touchstart', (e) => {
      touchStartX = e.changedTouches[0].screenX;
    });
    
    carousel.addEventListener('touchend', (e) => {
      touchEndX = e.changedTouches[0].screenX;
      handleSwipe();
    });
    
    function handleSwipe() {
      if (touchEndX < touchStartX) {
        // Swipe left
        goToSlide(currentIndex + 1);
      } else if (touchEndX > touchStartX) {
        // Swipe right
        goToSlide(currentIndex - 1);
      }
    }
  });
</script>

{% schema %}
{
  "name": "Carrousel d'avis",
  "tag": "section",
  "class": "testimonial-images-section",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Titre de la section",
      "default": "Nos avis clients"
    },
    {
      "type": "checkbox",
      "id": "enable_autoplay",
      "label": "Activer le défilement automatique",
      "default": false
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "min": 3,
      "max": 10,
      "step": 1,
      "unit": "s",
      "label": "Durée entre chaque défilement",
      "default": 5
    }
  ],
  "blocks": [
    {
      "type": "testimonial_image",
      "name": "Image d'avis",
      "limit": 20,
      "settings": [
        {
          "type": "image_picker",
          "id": "testimonial_image",
          "label": "Image d'avis"
        },
        {
          "type": "text",
          "id": "testimonial_alt",
          "label": "Texte alternatif",
          "default": "Avis client"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Carrousel d'avis clients",
      "blocks": [
        {
          "type": "testimonial_image"
        },
        {
          "type": "testimonial_image"
        },
        {
          "type": "testimonial_image"
        }
      ]
    }
  ]
}
{% endschema %}